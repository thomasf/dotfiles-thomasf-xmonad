#!/bin/sh
#
# Prompt for ssh hosts and connect
#
# Author: Thomas FrÃ¶ssman  ( thomasf@jossystem.se / http://thomas.jossystem.se )
# Updates to this file will probably be available at https://github.com/thomasf/dotfiles/
#
# based on http://blog.tenak.net/2010/07/2010-07-ssh_dmenu.html
#
# Since ssh_config keywords are case insensitive I use lower cased host
# keyword on hosts I don't want to show up in my dmenu.
#

set -e

if  [ `which yeganesh` ]; then
    args="yeganesh -p sshmenu -- -p SSH -l 30"
else
    args="dmenu -p SSH -l 30"
fi

cs=`cat ~/.ssh/config | grep ^Host | awk '{ print $2 }' | $args`

if [ ! -e ~/.config/darkmode ]; then
    termname="-name LURxvt"
fi

urxvt $termname -e sh -c \
     "while :
     do
      echo -n \`tput setaf 3\`
      echo Connecting: ${cs};
      echo -n \`tput sgr0\`
      ssh ${cs};
      echo ;
      echo \`tput setaf 1\`
      echo \"Connection to ${cs} lost: \`date\` \";
      echo \">>> Newline relaunches terminal\";
      echo \`tput sgr0\`
      read any;
      clear;
     done"
